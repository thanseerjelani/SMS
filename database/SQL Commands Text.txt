CREATE DATABASE IF EXISTS STUDENTMANAGEMENT;
USE STUDENTMANAGEMENT;

CREATE TABLE USERS(USERID INT AUTO_INCREMENT, USERNAME VARCHAR(30), PASSWORD VARCHAR(30), USERTYPE VARCHAR(10), PRIMARY KEY(USERID, USERNAME));

INSERT INTO USERS(USERNAME, PASSWORD, USERTYPE) VALUES ('ADMIN', 'ADMIN', 'ADMIN');

CREATE TABLE ADMINISTRATOR(USERID INT, NAME VARCHAR(30), PHONE VARCHAR(10), BACKUPCODE VARCHAR(10), PRIMARY KEY(USERID) , FOREIGN KEY (USERID) REFERENCES USERS(USERID) ON DELETE CASCADE);

INSERT INTO ADMINISTRATOR VALUES('1', 'ADMIN', '9876543210', 'ADMIN12345');

CREATE TABLE FACULTY(USERID INT NOT NULL, NAME VARCHAR(30), FACTID VARCHAR(15), DEPARTMENT VARCHAR(50), PRIMARY KEY(FACTID), FOREIGN KEY(USERID) REFERENCES USERS(USERID) ON DELETE CASCADE);

#INSERT INTO FACULTY VALUES('USERID', 'NAME', 'FACTID', 'DEPARTMENT');

CREATE TABLE STUDENT(USERID INT NOT NULL, USN VARCHAR(15), NAME VARCHAR(30), GENDER VARCHAR(8), DATEOFBIRTH DATE, ENROLLYEAR INT, DEPARTMENT VARCHAR(50), SEM INT, SEC VARCHAR(1), PRIMARY KEY(USN), FOREIGN KEY(USERID) REFERENCES USERS(USERID) ON DELETE CASCADE);

#INSERT INTO STUDENT VALUES('USERID', 'USN','NAME','GENDER','DATEOFBIRTH', 'ENROLLYEAR', 'DEPARTMENT', 'SEM', 'SEC');

CREATE TABLE SUBJECT(SUBCODE VARCHAR(10) PRIMARY KEY,NAME VARCHAR(60), CREDITS INT);

#

#SELECT NAME, DEPARTMENT, GENDER, SEM, SEC, DATEOFBIRTH, ENROLLYEAR FROM STUDENT WHERE USN = '';

CREATE TABLE MARKS(USN VARCHAR(15), SUBCODE VARCHAR(10), IA1MARKS INT, IA2MARKS INT,IA3MARKS INT, FINALIAMARK INT, SEMARKS INT, PRIMARY KEY(USN, SUBCODE), FOREIGN KEY(USN) REFERENCES STUDENT(USN) ON DELETE CASCADE, FOREIGN KEY(SUBCODE) REFERENCES SUBJECT(SUBCODE) ON DELETE CASCADE);

CREATE TABLE ATTENDANCE(USN VARCHAR(15), SUBCODE VARCHAR(10), TOTAL INT, ATTENDED INT, PRIMARY KEY(USN, SUBCODE), FOREIGN KEY(USN) REFERENCES STUDENT(USN) ON DELETE CASCADE, FOREIGN KEY(SUBCODE) REFERENCES SUBJECT(SUBCODE) ON DELETE CASCADE);

CREATE TABLE ENROLLED(SUBCODE VARCHAR(10) PRIMARY KEY, SEM INT, FOREIGN KEY(SUBCODE) REFERENCES SUBJECT(SUBCODE) ON DELETE CASCADE);

CREATE TABLE ASSIGNED(FACTID VARCHAR(15), SUBCODE VARCHAR(10), SEM INT, SEC VARCHAR(1), PRIMARY KEY(FACTID, SUBCODE, SEC), FOREIGN KEY(SUBCODE) REFERENCES SUBJECT(SUBCODE) ON DELETE CASCADE, FOREIGN KEY(FACTID) REFERENCES FACULTY(FACTID));

#INSERT INTO ATTENDANCE VALUES('USN', 'SUBCODE', 'TOTAL', 'ATTENDED');

/*
INSERT INTO ATTENDANCE VALUES('1JS19IS088', '18CS51', '20', '15');
INSERT INTO ATTENDANCE VALUES('1JS19IS088', '18CS53', '20', '18');
INSERT INTO ATTENDANCE VALUES('1JS19IS092', '18CS51', '20', '14');
INSERT INTO ATTENDANCE VALUES('1JS19IS092', '18CS53', '20', '19');
INSERT INTO ATTENDANCE VALUES('1JS19IS006', '18CS51', '20', '15');
INSERT INTO ATTENDANCE VALUES('1JS19IS006', '18CS51', '20', '19');
*/

#INSERT INTO MARKS VALUES('USN','SUBCODE','IA1MARKS','IAMARKS2', 'SEMARKS')

/*
INSERT INTO MARKS VALUES('1JS19IS088','18CS51',47,45, 0);
INSERT INTO MARKS VALUES('1JS19IS088','18CS53',45,43, 0);
INSERT INTO MARKS VALUES('1JS19IS092','18CS51',43,45, 0);
INSERT INTO MARKS VALUES('1JS19IS092','18CS53',45,45, 0);
INSERT INTO MARKS VALUES('1JS19IS006','18CS51',45,46, 0);
INSERT INTO MARKS VALUES('1JS19IS006','18CS53',46,47, 0);
*/


DROP TRIGGER IF EXISTS MARKSTRIGGER;
Delimiter //
CREATE TRIGGER MARKSTRIGGER
BEFORE UPDATE ON MARKS
FOR EACH ROW
BEGIN
IF (NEW.IA1MARKS IS NOT NULL AND NEW.IA2MARKS IS NOT NULL AND NEW.IA3MARKS IS NOT NULL) THEN
SET NEW.FINALIAMARK = (NEW.IA1MARKS + NEW.IA2MARKS + NEW.IA3MARKS)/3;
END IF;
END;
//
Delimiter ;

